<!DOCTYPE html>
<html>
  <head>
    <title>dex</title>
  </head>
  <body>
    <div>
      Rows:
      <input type="text" id="inputRow" value="4" style="width: 20px" />
      Cols:
      <input type="text" id="inputCol" value="8" style="width: 20px" />
      <button onclick="fetchData()">Change page size</button>
    </div>
    <div>
      <input type="text" id="inputImgWidth" value="50" style="width: 20px" />
      <button onclick="updateImgWidth()">Change card width</button> |
      <button onclick="updateInputImgWidth('delta', -100)">-100</button>
      <button onclick="updateInputImgWidth('delta', -10)">-10</button>
      <button onclick="updateInputImgWidth('absolute', 50)">50</button>
      <button onclick="updateInputImgWidth('absolute', 100)">100</button>
      <button onclick="updateInputImgWidth('absolute', 300)">300</button>
      <button onclick="updateInputImgWidth('delta', 10)">+10</button>
      <button onclick="updateInputImgWidth('delta', 100)">+100</button>
    </div>
    <div id="status"></div>
    <div id="content"></div>

    <script>
      const url =
        'https://script.google.com/macros/s/AKfycbyseTU2lYihy0VzgjKIgyqFKydSfd-mPkaHniW79BFgsHob_D7Cr6-Fd9sacErhmzdq/exec';
      document.getElementById('content').action = url;
      const cols = document.getElementById('inputCol');
      const rows = document.getElementById('inputRow');

      const fetchData = () => {
        document.getElementById('status').innerHTML = 'loading...';

        fetch(`${url}?header=tags`)
          .then((response) => response.json())
          .then(({ data }) => {
            fillBinder(data, rows.value, cols.value);
          })
          .catch(
            (error) => (document.getElementById('content').innerHTML = error)
          );
      };

      fetchData();

      const fillBinder = (data, rows, cols) => {
        newContent = '';
        imgWidth = document.getElementById('inputImgWidth').value;
        data.forEach((v, i) => {
          imgTag = `${v} style="width:${imgWidth}px;" />`;

          if (!rows || !cols) {
            newContent += imgTag;
          } else {
            rowIndex = (i + 1) % cols;
            pageIndex = (i + 1) % (rows * cols);
            tdTag = `<td>${imgTag}</td>`;
            fullTag = '';
            // first card on page
            if (pageIndex == 1) {
              fullTag += `<table style="float:left;padding:10px;">`;
            }
            // first card in row
            if (rowIndex == 1) {
              fullTag += `<tr>${tdTag}`;
            }
            // last card in row
            else if (rowIndex == 0) {
              fullTag += `${tdTag}</tr>`;
            }
            // middle card
            else {
              fullTag += `${tdTag}`;
            }
            // last card on page
            if (pageIndex == 0) {
              fullTag += '</table>';
            }
            newContent += fullTag;
          }
        });

        document.getElementById('content').innerHTML = newContent;
        document.getElementById('status').innerHTML = '';
      };

      const updateImgWidth = () => {
        document
          .querySelectorAll('img')
          .forEach(
            (e) =>
              (e.style.width = `${
                document.getElementById('inputImgWidth').value
              }px`)
          );
      };

      const updateInputImgWidth = (type, input) => {
        w = document.getElementById('inputImgWidth');

        if (type == 'delta') {
          wInt = parseInt(w.value) + parseInt(input);
          w.value = wInt.toString();
        } else {
          w.value = input;
        }
        updateImgWidth();
      };
    </script>
  </body>
</html>
