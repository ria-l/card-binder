<!DOCTYPE html>
<html>
  <head>
    <title>dex</title>
    <link rel="stylesheet" href="tcg.css" />
  </head>
  <body>
    <div>
      rows:
      <input type="text" id="rowinput" value="4" style="width: 20px" />
      cols:
      <input type="text" id="colinput" value="8" style="width: 20px" />
      <button onclick="getvalues()">Change page size</button>
    </div>
    <div>
      <input type="text" id="imgwidth" value="50" style="width: 20px" />
      <button onclick="changeWidth()">Change card width</button> |
      <button onclick="changeValueInput('d',-100)">-100</button>
      <button onclick="changeValueInput('d',-10)">-10</button>
      <button onclick="changeValueInput('a',50)">50</button>
      <button onclick="changeValueInput('a',100)">100</button>
      <button onclick="changeValueInput('a',300)">300</button>
      <button onclick="changeValueInput('d',10)">+10</button>
      <button onclick="changeValueInput('d',100)">+100</button>
    </div>
    <div id="status">loading...</div>
    <div id="content"></div>

    <script>
      const url =
        'https://script.google.com/macros/s/AKfycbyseTU2lYihy0VzgjKIgyqFKydSfd-mPkaHniW79BFgsHob_D7Cr6-Fd9sacErhmzdq/exec';
      document.getElementById('content').action = url;

      const getvalues = () => {
        document.getElementById('status').innerHTML = 'loading...';

        fetch(`${url}?header=tags`)
          .then((response) => response.json())
          .then(({ data }) => {
            fillBinder(data, rowvalue.value, colvalue.value);
          })
          .catch(
            (error) => (document.getElementById('content').innerHTML = error)
          );
      };
      let cols = 8;
      let rows = 4;

      // fetching the data from each column in the sheet
      // then populating the respective datalist
      let colvalue = document.getElementById('colinput');
      let rowvalue = document.getElementById('rowinput');
      getvalues();

      // function to add options to datalists
      const fillBinder = (arr, rows, cols) => {
        d = '';
        arr.forEach((v, i) => {
          za_width = document.getElementById('imgwidth').value;
          fulltag = `${v} style="width:${za_width}px;" />`;
          console.log(fulltag);
          if (!rows || !cols) {
            d += fulltag;
          } else {
            col_mod = (i + 1) % cols;
            row_mod = (i + 1) % (rows * cols);
            cell = `<td>${fulltag}</td>`;
            s = '';
            if (row_mod == 1) {
              s += `<table style='float:left;padding:10px;'>`;
            }
            if (col_mod == 0) {
              s += `${cell}</tr>`;
            } else if (col_mod == 1) {
              s += `<tr>${cell}`;
            } else {
              s += `${cell}`;
            }
            if (row_mod == 0) {
              s += '</table>';
            }
            d += s;
          }
        });

        document.getElementById('content').innerHTML = d;
        document.getElementById('status').innerHTML = '';
      };

      const changeWidth = () => {
        document
          .querySelectorAll('img')
          .forEach(
            (p) =>
              (p.style.width = `${document.getElementById('imgwidth').value}px`)
          );
      };

      const changeValueInput = (type, value) => {
        w = document.getElementById('imgwidth');

        if (type == 'd') {
          newval = parseInt(w.value);
          newval += parseInt(value);
          w.value = newval.toString();
        } else {
          w.value = value;
        }
        changeWidth();
      };
    </script>
  </body>
</html>
